# Service control_logic for project Homes Service

Сервис для управления и оперативного решения бытовых проблем в ЖК через
заявки на веб платформу и телеграмм бота. Автоматизация взаимодействия 
между жильцами, УК и сервисных служб.

## Цели:
- Создать удобный и простой инструмент для быстрого решения бытовых проблем 
и коммуникаций внутри помещений ЖК
- Обеспечить жителей возможностью оперативно сообщать о проблемах (неимппавности
лифта, протечка, уборка и др.) за пару кликов
- Автоматическое уведомления жителей, в части касающихся, о проблеме
по созданной заявке

Запуск проекта: 
-
### 1. Каталог .src - SourceRoot
- В корень проекта положить .env файл с переменными из settings.py
- На проде в переменной IS_UVICORN_WORK_SERVER выставить флаг False

### 2. Poetry (виртуальное окружение):
```commandline
sudo apt install python3-poetry
cd ~/control_logic
poetry env use python3.11 // если на ПК установлено несколько версий Python
// в проекте используется python3.11 и выше
poetry shell
poetry install

cd ~/control_logic/src
```

### 3. Поднять базу данных в Docker:
```commandline
sudo docker-compose up -d
```
### 4. Поднять Redis в Docker:
```commandline
docker-compose -f docker-compose-redis.yml up -d
```

### 5. Миграции:
```commandline
alembic init database/migrations  // Инициализация alembic (Инициализация выполнена. Не запускать)
alembic revision --autogenerate -m "default" // Собрать миграции. -m Добавить имя миграции
alembic upgrade head  // Применить миграции
```



### 6. Запуск проекта:

- Находимся в каталоге src
- Из каталога src, вызовом команды python3 main.py (При этом флаг IS_UVICORN_WORK_SERVER должен иметь значение True)
- Либо стандартными методами Pycharm


### Кастомизация:

- Переопределен базовый класс pydantic BaseModel. Все схемы наследовать от PydanticDictModel
- В Redis используется автоматическое переподключение при сбое.  Перед использованием 
прочитать документацию к пакету!
- Подключено и настроено логирование с помощью библиотеки logger
- Добавлена самописная библиотека кеширования данных. Перед использованием 
прочитать инструкцию service.cache в файле __init.py__

